# 云计算认证笔记

## 云计算简介

- 云计算是什么
- 云计算历史
- 云计算案例
- 云计算特点

![092643c6l4nbneayy4ot1d](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/092643c6l4nbneayy4ot1d.png?raw=true)



### 优势

1. 按需自助服务
2. 广泛的网络接入
3. 资源池化
4. 快速弹性伸缩
5. 可计量服务

### 定义

​	云计算是一种**模型**，可以实现随时随地，便捷地，随需应变地从可配置计算资源共享池中获取所需的**资源(网络，服务器，存储，应用及服务)**，资源能够快速供应并释放，使管理资源的工作量和与服务提供商的交互减少到最低限度。

​	通俗讲，云，是网络，互联网的一种比喻说法，即互联网与建立互联网所需要的底层基础设施的抽象体。计算指的是一台足够强大的计算机提供的计算服务，包括各种功能，资源，存储。云计算可以理解：通过互联网可以使用足够的计算机为用户提供的服务，这种服务的使用量可以使用统一的单位来描述。

### 互联网发展史

ARPANET - > TCP/IP - > DNS -> www - > Facebook社交网络元年 - > HTTPS

![1576739001(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576739001(1).jpg?raw=true)

### 计算发展史

1. 串行式计算：如果问题太复杂，处理时间会较长。如果解决更大规模的问题，用单个CPU解决不切实际。

   限制：

   - 传输速度，线性计算机的执行速度直接取决于数据在硬件中传输的速度
   - 微型化极限，处理器技术使芯片集成了更多的晶体管。但是芯片集成晶体管有极限
   - 经济上的限制，让单个芯片变得更快需要增加昂贵的投入

2. 并行式计算：让多个CPU同时参与到任务的执行中。

   特点：

   - 节省时间和成本
   - 解决使用串行计算无法解决的问题

3. 分布式计算：将自己所有组件分散在属于不同网络的计算机上，通过统一的消息机制来相互通讯和配合，完成共同的目标。

   优点：

   - 稀有资源可以共享
   - 通过分布式计算可以在多台计算机上平衡计算负载
   - 可以把程序放在最适合它的计算机上

   其中共享稀有资源和平衡负载是核心思想之一

4. 网格计算：利用广泛的零散的计算资源完成一个共同任务，也是分布式计算的一种。通常使用集群的方式实现。

5. 云计算：共享基础架构的方法，可以将巨大的系统池连接在一起以提供各种IT服务。

   - 狭义云计算：IT基础设施的交付和使用模式，通过网络以按需，易扩展的方式获取所需的资源(硬件、平台、软件)。可以随时获取，按需使用，随时扩展，按使用付费。
   - 广义云计算：服务的交付和使用模式，通过网络以按需、易扩展的方式获得所需的服务。这种服务可以是IT、软件和互联网相关的，也可以是其他任意的服务。

   云计算相同点：

   1. 超大规模
   2. 虚拟化
   3. 高可靠性
   4. 通用性
   5. 高扩展性
   6. 按需服务
   7. 极其廉价

![1576739106(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576739106(1).jpg?raw=true)

### 云计算发展

1. 云计算 1.0

   面向数据中心管理员的IT基础设施资源虚拟化阶段。关键特征是通过计算虚拟化技术的引入，将企业IT应用与底层的基础设施彻底分离解耦，将多个企业IT应用实例及运行环境复用在相同的物理服务器上，并通过虚拟化集群调度软降，将更多的IT应用复用在更少的服务器节点上，从而实现资源利用率的提升。

2. 云计算 2.0

   面向基础设施云租户和云用户的资源服务化与管理自动化阶段。特征为通过平面的基础设计标准化服务于资源调度自动化软件的引入，以及数据平面的软件定义存储和软件网络技术，面向内部和外部的租户，将原本需要通过数据中心管理员人工干预的基础设施资源复杂低效申请、释放和配置过程，转变为在必要的限定条件下的一键式全自动化资源发放服务过程。

   基础设施资源服务供给，可以是虚拟机形式，可以是容器形式，也可以是物理机形式。

3. 云计算 3.0

   面向企业IT应用开发者及管理维护者的企业应用架构的分布式微服务化和企业数据架构的互联网重构及大数据智能化阶段。将走向(依托开源增强的、跨不同业务应用领域高度共享的)数据库，中间件平台服务层及(功能更加轻量化解耦、数据和应用逻辑彻底分离的)分布式无状态化架构。

![1576739142(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576739142(1).jpg?raw=true)

### 云计算模式

运营模式

- 公有云：百度云，华为云，有道云
- 私有云：部署在企业和单位内部，私有云上的数据全部保存在企业自有的数据中心。或在公有云上购买专属云服务，将关键业务放在公有云上，保证用户在云上拥有专属的计算和存储资源。
- 混合云：由于安全和控制原因，并非所有企业信息都能放在公有云上，这样将会使用混合云模式，同时使用公有云和私有云。
- 行业云：以公开或半公开的方式，向行业内部或相关组织和公众提供有偿或无偿服务的云平台，具有一些行业特性。如医药行业，银行业等。

服务模式

- IaaS：基础设施层由云服务商提供，其他由用户自营
- PaaS：基础设施层和平台层由云服务商提供，其他由用户自营
- SaaS：全部由云服务商提供

![1576739467(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576739467(1).jpg?raw=true)

## 实验手册

![152006hoodzc7yeinyiiib](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/152006hoodzc7yeinyiiib.png?raw=true)

## 计算虚拟化

使用虚拟化，可以在物理服务器上模拟出多个独立的服务器来。本质是将原先的物理设备进行逻辑化，转化成一个文件夹或文件，实现软硬件的解耦。

### 计算虚拟化发展史

1. IBM实现分时系统，并将一个CPU虚拟化成多个虚拟CPU，并且让每颗CPU看起来在同时运行，推出system370机。
2. VMware推出最早的能在X86架构上运行的虚拟化产品。
3. Xen正式被开源，开始支持Intel，可以运行完全没有修改的操作系统。
4. Qumranet正式对外宣布KVM诞生，KVM模块的源代码正式被纳入Linux Kernel。
5. Linux推出LXC，是第一套完整的Linux容器管理实现方案。
6. Docker引入一整套和容器管理相关的生态系统。

![1576741245(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576741245(1).jpg?raw=true)

### 虚拟化架构

 ![1576741291(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576741291(1).jpg?raw=true)

- Guest OS：虚拟机操作系统
- Guest Machine：虚拟出来的虚拟机
- Hypervisor：虚拟化软件层/虚拟机监控机
- Host OS：运行在物理机上的OS
- Host Machine：物理机

### 虚拟化分类

根据Hypervisor的不同类型，我们将虚拟化分为 I 型和 II 型两种(把容器算成 III 型)。

- **I 型**：裸金属虚拟化，Hypervisor直接调用硬件资源，不需要底层Host OS。可以将Hypervisor看作成一个定制的Host OS，除了起到VMM的作用外，一般不能在其上安装其他应用。

  Hypervisor主要实现两个基本功能：

  1. 首先是识别、捕获和响应虚拟机发出的CPU特权指令或保护指令；
  2. 其次，它负责处理虚拟机队列和调度，并将物理硬件的处理结果返回给相应的虚拟机。也就是说，Hypervisor负责管理所有的资源和虚拟环境。

  **特点**

  ​	优点：虚拟机不依赖于操作系统，支持多种操作系统和多种应用。

  ​	缺点：虚拟化层内核开发难度大。

- **II 型：** 宿主型虚拟化，此模型的物理资源又Host OS(例如 Windows Linux)管理，实际的虚拟化功能由VMM提供。

  VMM：

  通过创建相应的虚拟机，共享底层服务器资源。通过调用Host OS的服务来获得资源，实现CPU、内核和I/O设备的虚拟化。

  **特点**

  ​	优点：简单、易于实现

  ​	缺点：安装和运行应用程序依赖于主机操作系统对设备的支持。管理开销较大，性能损耗大。

![1576742231(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576742231(1).jpg?raw=true)

### 虚拟化特点

- 分区：意味着虚拟化层为多个虚拟机划分服务器资源的能力。解决两方面问题：
  1. 每个分区划分资源配额，防止虚拟化超配额使用资源
  2. 每个虚拟机单独安装操作系统，彼此互不影响
- 隔离：通过分区所建立的多个虚拟机之间采用逻辑隔离措施，防止相互影响。解决两方面问题：
  1. 一个虚拟机的崩溃或故障，不会影响同一服务器上的其他虚拟机
  2. 一个虚拟机中的病毒，蠕虫等，与其他虚拟机相隔离，就像每个虚拟机都位于单独的物理机上一样
- 封装：将整个虚拟机(硬件配置、BIOS配置、内存状态、磁盘状态、CPU状态)储存在独立于物理硬件的一小组文件中。只需复制几个文件就可以随时随地根据需要复制、保存和移动虚拟机。对虚拟机的迁移而言，最重要的就是封装特性。
- 独立：虚拟机封装为独立文件后，虚拟机迁移只需要把虚拟机设备文件和配置文件或磁盘文件复制到另一台主机上运行即可，而不用关心底层的硬件类型是否兼容，这就是相对硬件的独立性。

### CPU虚拟化

CPU的分级保护域，在这种保护模式中，CPU被分为4个环

- Ring 0：最高权限，可以直接操作硬件，一般只有操作系统和驱动会允许拥有此权限。
- Ring 1：次之
- Ring 2：再次之
- Ring 3：最低权限，所有程序都拥有此权限。

主机操作系统所发出的指令一般分为两种：特权指令和普通指令

- 特权指令：用于操作和管理关键系统资源的指令，这些指令只在最高特权级上才能够运行，即必须在Ring 0级别上才能运行
- 普通指令：这些指令在CPU普通权限级别上就能够运行，即在Ring 3级别上可以运行。

**CPU虚拟化解决方案**

- 全虚拟化
- 半虚拟化
- 硬件辅助虚拟化

**全虚拟化**

​	经典“特权解除”和“陷入模式”虚拟化方案不适合X86架构的CPU，根本原因在那19条超出特权指令的敏感指令，运行在Ring 1用户态，不能陷入-模拟被虚拟机监控器(VMM)捕获。

​	虚拟机发出的操作系统请求转发到VMM，VMM对请求进行二进制翻译，如果发型特权指令或敏感指令，则陷入到VMM模式执行，然后调度到CPU特权级别上执行；如果只是应用程序指令则直接在CPU非特权级别上执行。这种方法需要过滤所有虚拟机发出的请求指令，因而被称为全虚拟化方式。

**半虚拟化**

​	虚拟化漏洞的问题来源于19条敏感指令，如果我们可以修改虚拟操作系统Guest OS规避虚拟化漏洞，那么问题就解决了。

​	半虚拟化修改虚拟机操作系统Guest OS，让虚拟机操作系统能够意识到自己是被虚拟化的，虚拟机操作系统会“超级调用”Hypervisor层来替换虚拟化中的敏感指令，从而实现虚拟化，而其他应用程序等非敏感或非特权请求则直接在CPU非特权级别上执行。

 ![1576742293](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576742293.jpg?raw=true)

**硬件辅助虚拟化**

​	虚拟化漏洞问题的解决，无论是全虚拟化还是半虚拟化，都默认物理硬件不具备虚拟化识别功能，因此必须识别这19条敏感指令，并通过VMM进行陷入-模拟。

​	Intel推出VT-x的CPU，AMD也推出AMD-V的CPU。VT-x和AMD-V，这两种技术都为CPU增加了新的执行模式 - root模式。可以让VMM运行在root模式下，而root模式位于CPU指令级别Ring 0下。

​	特权和敏感指令自动在Hypervisor上执行，所以无需全虚拟化或半虚拟化技术。这种通过硬件辅助虚拟化解决虚拟化漏洞，简化VMM工作。

![1577455116(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577455116(1).jpg?raw=true)

### 内存虚拟化

​	内存虚拟化把物理机的真实物理内存统一管理，包装成多份虚拟的内存给若干虚拟机使用。核心在于引入一层新的地址空间 - 客户机物理地址空间。客户机以为自己运行在真实的物理地址空间中，实际上它是通过VMM访问真实的物理地址，在VMM中保存的是客户机地址空间和物理机地址空间之间的映射表。

![1576742321(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576742321(1).jpg?raw=true)

​	内存虚拟化的内存地址涉及三种内存地址：虚拟机内存地址(VA)，物理内存地址(PA)和机器内存地址(MA)。

​	需要实现	VA(虚拟内存) - > PA(物理内存) - > MA(机器内存) 之间地址转换。虚拟机Guest OS控制虚拟地址到客户内存物理地址的映射( VA - > PA )，Hypervisor负责映射客户物理内存到实际机器内存( PA - > MA )。

### I/O虚拟化

​	VMM用于截获虚拟机对I/O设备的访问请求，再通过软件去模拟真实的I/O设备，进而响应I/O请求。

实现I/O虚拟化的方式主要有三种

- 全虚拟化
- 半虚拟化
- 硬件辅助虚拟化：是目前I/O虚拟化的主流技术

**全虚拟化**

​	通过VMM为虚拟机模拟出一个与真实设备类似的虚拟I/O设备，当虚拟机对I/O设备发起I/O请求时，VMM截获虚拟机下发的I/O访问请求，再由VMM将真实的访问请求发送到物理设备进行处理。

​	优点：无论使用任何类型操作系统，都不要为I/O虚拟化做任何修改，可以让多个虚拟机直接使用物理服务器的I/O设备

​	缺点：VMM需要实时截获每个虚拟机下发的I/O请求，然后模拟到真实的I/O设备中。给服务器带来较严重的性能损耗。

**半虚拟化**

​	需要建立一个特权级别的虚拟机。要求各个虚拟机运行前端驱动程序，当访问I/O设备时，虚拟机通过前端驱动程序把I/O请求发送给特权虚拟机，由特权虚拟机后端驱动收集每个虚拟机发出的I/O请求，再由后端驱动对多个I/O请求进行分时分通道处理。

​	特权虚拟机运行真实的物理I/O设备驱动，将I/O请求发送给物理I/O设备，I/O设备处理完成后再将结果返回给虚拟机。

​	优点：主动让虚拟机把I/O请求发送给特权虚拟机，再由特权虚拟机访问真实的I/O设备，减少VMM性能损耗

​	缺点：需要修改虚拟机操作系统，改变操作系统对自身I/O请求的处理方式。

 ![1577456745(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577456745(1).jpg?raw=true)

Domain 0就是特权虚拟机，Domain U是用户虚拟机。

**硬件辅助虚拟化**

​	将I/O设备驱动直接安装在虚拟机操作系统中，不需要对操作系统做任何修改。IO透传，直接分配给虚拟机物理设备，例如直接分配一个硬盘或网卡给虚拟机，需要硬件具备IO透传技术。

### Xen和KVM比较

**Xen**

​	同时支持半虚拟化和全虚拟化，直接运行在硬件上，然后在其之上运行虚拟机。Xen中的虚拟机分为两类：Domain 0和Domain U。Domain 0是一个特权虚拟机，具有直接访问硬件和管理其他普通虚拟机Domain U的权限。Domain 0先启动，Domain U后启动，然后将所有的操作都通过前后端驱动的方式转给Domain 0，再由Domain 0完成具体的操作后将结果返回给Domain U。

![1576742516(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576742516(1).jpg?raw=true)

**KVM**

​	KVM，全称是Kernel-base Virtual Machine(基于内核的虚拟机)，是一种典型的 II 型全虚拟化。KVM本身是一个Linux内核模块，当安装有Linux系统的物理机有这个模块后，就变成了Hypervisor，而且不会影响原先在该Linux上运行的其他应用程序，而且每个虚拟机都是进程，可以直接用Kill命令杀掉。

一个Linux安装KVM模块后，会增加三种运行模式

- Guest Mode：主要是指虚拟机，包括虚拟机的CPU、内存、磁盘等虚拟设备，该模式被置于一种受限的CPU模式下运行；
- User Mode：此模式下运行的主要是QEMU，用来为虚拟机模拟执行I/O类的操作请求；
- Kernel Mode：此模式下可以真正操作硬件，当Guest OS执行I/O类操作或特权指令操作时，需要向用户模式提交请求，然后由用户模式再次发起硬件操作请求给内核模式，从而真正操作硬件。

KVM体系包括三部分

- KVM内核模块
- QEMU
- 管理工具

 ![1577458543(1)](resources\1577458543(1).jpg)



## 云计算网络基础

网络基础

- 广播和单播
- 路由
- 默认网关
- VLAN

物理网络设备

- 路由器
- 三层交换机
- 二层交换机
- 服务器网卡

物理网卡

 ![1576818035(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818035(1).jpg?raw=true)

虚拟网络架构

![1576818093(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818093(1).jpg?raw=true)

桥接和NAT

![1576818121(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818121(1).jpg?raw=true)

虚拟交换机

Open vSwitch

FusionCompute网络架构

 ![1576818197(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818197(1).jpg?raw=true)

## 云计算存储基础

虚拟化存储架构

![1576818296(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818296(1).jpg?raw=true)

虚拟化存储转换路径

 ![1576818338(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818338(1).jpg?raw=true)

非虚拟化存储转换路径

 ![1576818380(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818380(1).jpg?raw=true)

物理磁盘类型

- SATA：采用串行连接方式，串行ATA总心啊使用嵌入式时钟信息，具备更强的纠错能力。
- SAS：串行连接SCSI，采用串行技术获得更高的传输速度，并通过缩短连接线改善内部空间等。此接口的设计是改善存储系统的效能，可用性和扩充性，并且提供与SATA硬盘的兼容性。
- NL - SAS：采用SAS磁盘接口和SATA盘体的综合体，在寻址和速度上有了提升。
- SSD：用固态电子存储芯片阵列而制成的硬盘，由控制单元和存储单元(FLASH芯片，DRAM芯片)组成。具有快速读写，质量轻，能耗低以及体积小等。

集中式存储

 ![1576818746(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818746(1).jpg?raw=true)

RAID类型

![1576818793(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818793(1).jpg?raw=true)

集中式存储类型

![1576818850(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818850(1).jpg?raw=true)

分布式存储

 ![1576818876(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818876(1).jpg?raw=true)

副本机制

 ![1576818921(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1576818921(1).jpg?raw=true)

RAID和LUN

- RAID由几个硬盘组成，从整体上相当于由多个硬盘组成的一个大的物理卷
- 在物理卷的基础上可以按照指定容量创建一个或多个逻辑单元，这些逻辑单元称为LUN，可以作为映射给主机的基本块设备

 ![1577156037(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577156037(1).jpg?raw=true)

华为虚拟化产品存储架构

 ![1577156134(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577156134(1).jpg?raw=true)

虚拟化特性介绍

虚拟化集群特性

- HA
- 负载均衡
- 易扩容
- 内存复用

 ![1577156368(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577156368(1).jpg?raw=true)

虚拟机特性

- 模板部署，虚拟机复制
- 资源热添加，Console控制
- 快照

![1577156466(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577156466(1).jpg?raw=true)

## 云计算发展

OpenStack组成

![1577156697(1)](https://github.com/orangehaswing/HCIA-CloudComputing/blob/master/resources/1577156697(1).jpg?raw=true)

















































